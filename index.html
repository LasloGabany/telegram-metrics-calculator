<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø–æ–¥–ø–∏—Å–∫–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --accent: #ec4899;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 15px;
      overflow-x: hidden;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
    .app-header {
      text-align: center;
      margin-bottom: 25px;
      padding: 15px 0;
    }

    .app-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: white;
      margin-bottom: 5px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .app-subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 0.95rem;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.15);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(99, 102, 241, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title::before {
      content: '';
      width: 5px;
      height: 24px;
      background: linear-gradient(to bottom, var(--primary), var(--secondary));
      border-radius: 3px;
    }

    /* –§–æ—Ä–º—ã */
    .form-group {
      margin-bottom: 18px;
    }

    label {
      display: block;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(99, 102, 241, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
      box-shadow: none;
    }

    .btn-secondary:hover {
      background: var(--primary);
      color: white;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn-group .btn {
      flex: 1;
    }

    /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
    .results {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .metric-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 16px;
      padding: 16px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border-radius: 0 16px 0 60px;
    }

    .metric-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    .metric-label {
      font-size: 0.85rem;
      color: #64748b;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .metric-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* –°–≤–µ—Ç–æ—Ñ–æ—Ä */
    .traffic-light {
      display: flex;
      justify-content: center;
      margin: 25px 0;
    }

    .light {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: white;
      font-weight: bold;
      box-shadow: var(--shadow-lg);
      transition: all 0.5s ease;
    }

    .light.green {
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    }

    .light.yellow {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
    }

    .light.red {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
    }

    .light.neutral {
      background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–≤–µ—Ä—Ö—É */
    .stats-bar {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #64748b;
      font-weight: 600;
    }

    /* –ì—Ä–∞—Ñ–∏–∫ */
    .chart-container {
      height: 250px;
      margin: 20px 0;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      padding: 15px;
      box-shadow: var(--shadow);
    }

    /* –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ */
    .detailed-metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .detail-metric {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 16px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .detail-metric-label {
      font-size: 0.85rem;
      color: #64748b;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .detail-metric-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* –°–≤–æ–¥–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
    .efficiency-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 20px;
      border-radius: 16px;
      margin: 20px 0;
      box-shadow: var(--shadow-lg);
    }

    .efficiency-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .progress-bar {
      height: 12px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 6px;
      overflow: hidden;
      margin: 15px 0;
    }

    .progress-fill {
      height: 100%;
      background: white;
      border-radius: 6px;
      transition: width 1s ease;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .efficiency-text {
      font-size: 0.95rem;
      opacity: 0.9;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .action-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.3s ease;
    }

    .share-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4);
    }

    .report-btn {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .report-btn:hover {
      background: var(--primary);
      color: white;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--dark);
      color: white;
      padding: 14px 24px;
      border-radius: 50px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      font-weight: 600;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
      }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .results {
        grid-template-columns: 1fr;
      }
      
      .detailed-metrics {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .stats-bar {
        flex-wrap: wrap;
        gap: 15px;
      }
      
      .stat-item {
        flex: 1;
        min-width: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="app-header">
      <h1 class="app-title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç—Ä–∏–∫</h1>
      <p class="app-subtitle">–û—Ü–µ–Ω–∏—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–∞—à–µ–π –ø–æ–¥–ø–∏—Å–Ω–æ–π –º–æ–¥–µ–ª–∏</p>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="tgLTV">--</div>
        <div class="stat-label">LTV</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="tgCAC">--</div>
        <div class="stat-label">CAC</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="tgEfficiency">--</div>
        <div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
      </div>
    </div>

    <div class="grid">
      <!-- –í–•–û–î–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò -->
      <div class="card">
        <h2 class="card-title">–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        
        <div class="form-group">
          <label for="startSubs">–ù–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</label>
          <input type="number" id="startSubs" min="0" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤">
        </div>
        
        <div class="form-group">
          <label for="churnUsers">–û—Ç—Ç–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥</label>
          <input type="number" id="churnUsers" min="0" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø–∏—Å–∞–≤—à–∏—Ö—Å—è">
        </div>
        
        <div class="form-group">
          <label for="marketingSpend">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã, ‚ÇΩ</label>
          <input type="number" id="marketingSpend" min="0" placeholder="–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É">
        </div>
        
        <div class="form-group">
          <label for="newSubs">–ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏</label>
          <input type="number" id="newSubs" min="0" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤">
        </div>
        
        <div class="form-group">
          <label for="newSubsMonthly">–ù–æ–≤—ã—Ö –≤ –º–µ—Å—è—Ü</label>
          <input type="number" id="newSubsMonthly" min="0" placeholder="–°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫">
        </div>
        
        <div class="form-group">
          <label for="price">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏, ‚ÇΩ</label>
          <input type="number" id="price" min="0" step="0.01" placeholder="–¶–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏">
        </div>
        
        <div class="form-group">
          <label for="grossMargin">–í–∞–ª–æ–≤–∞—è –º–∞—Ä–∂–∞, %</label>
          <input type="number" id="grossMargin" min="0" max="100" placeholder="–î–æ–ª—è –ø—Ä–∏–±—ã–ª–∏">
        </div>
        
        <div class="btn-group">
          <button class="btn pulse" onclick="calculate()">
            <span>üöÄ</span> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
          </button>
          <button class="btn btn-secondary" onclick="resetForm()">
            <span>üîÑ</span> –°–±—Ä–æ—Å
          </button>
        </div>
      </div>
      
      <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
      <div class="card">
        <h2 class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        
        <div id="results" class="results">
          <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #64748b;">
            –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
          </div>
        </div>
        
        <div class="traffic-light">
          <div id="trafficLight" class="light neutral">?</div>
        </div>
        
        <div class="action-buttons">
          <button class="action-btn share-btn" onclick="shareResults()">
            <span>üì§</span> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
          </button>
          <button class="action-btn report-btn" onclick="generateReport()">
            <span>üìä</span> –û—Ç—á–µ—Ç
          </button>
        </div>
      </div>
    </div>
    
    <!-- –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–ê–ù–ï–õ–¨ -->
    <div class="card">
      <h2 class="card-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
      
      <div class="chart-container">
        <canvas id="metricsChart"></canvas>
      </div>
      
      <div class="detailed-metrics">
        <div class="detail-metric">
          <div class="detail-metric-label">ROMI</div>
          <div class="detail-metric-value" id="romi">--</div>
        </div>
        <div class="detail-metric">
          <div class="detail-metric-label">–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å</div>
          <div class="detail-metric-value" id="breakEven">--</div>
        </div>
      </div>
      
      <div class="efficiency-card">
        <h3 class="efficiency-title">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å–∞</h3>
        <div class="progress-bar">
          <div class="progress-fill" id="efficiencyBar"></div>
        </div>
        <div class="efficiency-text" id="summaryText">
          –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        </div>
      </div>
    </div>
  </div>
  
  <div id="toast" class="toast">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!</div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª
    const fmt = (n, d = 2) => {
      return new Intl.NumberFormat('ru-RU', {
        maximumFractionDigits: d,
        minimumFractionDigits: d
      }).format(n);
    };
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM
    const elements = {
      startSubs: document.getElementById('startSubs'),
      churnUsers: document.getElementById('churnUsers'),
      marketingSpend: document.getElementById('marketingSpend'),
      newSubs: document.getElementById('newSubs'),
      newSubsMonthly: document.getElementById('newSubsMonthly'),
      price: document.getElementById('price'),
      grossMargin: document.getElementById('grossMargin'),
      results: document.getElementById('results'),
      trafficLight: document.getElementById('trafficLight'),
      romi: document.getElementById('romi'),
      breakEven: document.getElementById('breakEven'),
      efficiencyBar: document.getElementById('efficiencyBar'),
      summaryText: document.getElementById('summaryText'),
      tgLTV: document.getElementById('tgLTV'),
      tgCAC: document.getElementById('tgCAC'),
      tgEfficiency: document.getElementById('tgEfficiency')
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    const ctx = document.getElementById('metricsChart').getContext('2d');
    const metricsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω'],
        datasets: [{
          label: 'LTV',
          data: [12000, 13500, 14200, 15000, 15800, 16500],
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99, 102, 241, 0.1)',
          tension: 0.4,
          fill: true
        }, {
          label: 'CAC',
          data: [8000, 8200, 7900, 8100, 7800, 7600],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              usePointStyle: true,
              padding: 20,
              font: {
                size: 12,
                weight: '600'
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            ticks: {
              font: {
                size: 11
              }
            }
          },
          x: {
            grid: {
              display: false
            },
            ticks: {
              font: {
                size: 11
              }
            }
          }
        }
      }
    });
    
    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ ROMI
    function calculateROMI(ltv, cac) {
      return ((ltv - cac) / cac * 100).toFixed(1);
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ break-even
    function calculateBreakEven(cac, arpu) {
      return (cac / arpu).toFixed(1);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å–≤–æ–¥–∫–∏
    function getSummaryText(efficiency) {
      if (efficiency >= 80) return "üöÄ –û—Ç–ª–∏—á–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å! –í–∞—à –±–∏–∑–Ω–µ—Å –æ—á–µ–Ω—å —É—Å—Ç–æ–π—á–∏–≤.";
      if (efficiency >= 60) return "‚ö° –•–æ—Ä–æ—à–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ï—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.";
      if (efficiency >= 40) return "‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è.";
      return "üî¥ –ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ.";
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
    function calculate() {
      // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –ø–æ–ª–µ–π
      const data = {
        startSubs: parseFloat(elements.startSubs.value) || 0,
        churnUsers: parseFloat(elements.churnUsers.value) || 0,
        marketingSpend: parseFloat(elements.marketingSpend.value) || 0,
        newSubs: parseFloat(elements.newSubs.value) || 0,
        newSubsMonthly: parseFloat(elements.newSubsMonthly.value) || 0,
        price: parseFloat(elements.price.value) || 0,
        grossMargin: parseFloat(elements.grossMargin.value) || 0
      };
      
      // –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫
      const churnRate = data.startSubs > 0 ? data.churnUsers / data.startSubs : 0;
      const retention = 1 - churnRate;
      const cac = data.newSubs > 0 ? data.marketingSpend / data.newSubs : 0;
      const arpu = data.price * (data.grossMargin / 100);
      const ltv = retention > 0 && retention < 1 ? arpu * (retention / (1 - retention)) : 0;
      const payback = arpu > 0 ? cac / arpu : 0;
      const ratio = ltv > 0 ? cac / ltv : 0;
      
      // –†–∞—Å—á–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
      const romi = calculateROMI(ltv, cac);
      const breakEven = calculateBreakEven(cac, arpu);
      const efficiency = Math.min(100, Math.max(0, (ltv / cac - 1) * 50));
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      elements.results.innerHTML = `
        <div class="metric-card">
          <div class="metric-label">–û—Ç—Ç–æ–∫</div>
          <div class="metric-value">${fmt(churnRate * 100)}%</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">–£–¥–µ—Ä–∂–∞–Ω–∏–µ</div>
          <div class="metric-value">${fmt(retention * 100)}%</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">CAC</div>
          <div class="metric-value">${fmt(cac)} ‚ÇΩ</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">LTV</div>
          <div class="metric-value">${fmt(ltv)} ‚ÇΩ</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å</div>
          <div class="metric-value">${fmt(payback, 1)} –º–µ—Å.</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">CAC/LTV</div>
          <div class="metric-value">${fmt(ratio * 100)}%</div>
        </div>
      `;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞
      if (ratio <= 0.33 && payback <= 6) {
        elements.trafficLight.className = 'light green';
        elements.trafficLight.textContent = '‚úì';
      } else if (ratio <= 0.50 && payback <= 12) {
        elements.trafficLight.className = 'light yellow';
        elements.trafficLight.textContent = '!';
      } else {
        elements.trafficLight.className = 'light red';
        elements.trafficLight.textContent = '‚úó';
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
      elements.romi.textContent = romi + '%';
      elements.breakEven.textContent = breakEven + ' –º–µ—Å.';
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏
      elements.efficiencyBar.style.width = efficiency + '%';
      elements.summaryText.textContent = getSummaryText(efficiency);
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Telegram —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      elements.tgLTV.textContent = fmt(ltv) + ' ‚ÇΩ';
      elements.tgCAC.textContent = fmt(cac) + ' ‚ÇΩ';
      elements.tgEfficiency.textContent = efficiency.toFixed(0) + '%';
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
      updateChart(ltv, cac);
      
      // –í–∏–±—Ä–∞—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
      if (tg.HapticFeedback) {
        tg.HapticFeedback.impactOccurred('medium');
      }
      
      showToast('–†–∞—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    function updateChart(ltv, cac) {
      const currentMonth = new Date().toLocaleString('ru', { month: 'short' });
      
      metricsChart.data.datasets[0].data.push(ltv);
      if (metricsChart.data.datasets[0].data.length > 6) {
        metricsChart.data.datasets[0].data.shift();
      }
      
      metricsChart.data.datasets[1].data.push(cac);
      if (metricsChart.data.datasets[1].data.length > 6) {
        metricsChart.data.datasets[1].data.shift();
      }
      
      metricsChart.data.labels.push(currentMonth);
      if (metricsChart.data.labels.length > 6) {
        metricsChart.data.labels.shift();
      }
      
      metricsChart.update();
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
    function resetForm() {
      elements.startSubs.value = '';
      elements.churnUsers.value = '';
      elements.marketingSpend.value = '';
      elements.newSubs.value = '';
      elements.newSubsMonthly.value = '';
      elements.price.value = '';
      elements.grossMargin.value = '';
      
      elements.results.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #64748b;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"</div>';
      elements.trafficLight.className = 'light neutral';
      elements.trafficLight.textContent = '?';
      
      elements.romi.textContent = '--';
      elements.breakEven.textContent = '--';
      
      elements.efficiencyBar.style.width = '0%';
      elements.summaryText.textContent = '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
      
      elements.tgLTV.textContent = '--';
      elements.tgCAC.textContent = '--';
      elements.tgEfficiency.textContent = '--';
      
      showToast('–§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    function shareResults() {
      const resultsText = document.getElementById('results').innerText;
      
      if (resultsText && resultsText !== '–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"') {
        tg.shareMessage(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫ –ø–æ–¥–ø–∏—Å–∫–∏:\n\n${resultsText}`);
        showToast('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!');
      } else {
        showToast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç');
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
    function generateReport() {
      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
      const data = {
        startSubs: parseFloat(elements.startSubs.value) || 0,
        churnUsers: parseFloat(elements.churnUsers.value) || 0,
        marketingSpend: parseFloat(elements.marketingSpend.value) || 0,
        newSubs: parseFloat(elements.newSubs.value) || 0,
        newSubsMonthly: parseFloat(elements.newSubsMonthly.value) || 0,
        price: parseFloat(elements.price.value) || 0,
        grossMargin: parseFloat(elements.grossMargin.value) || 0
      };
      
      // –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫
      const churnRate = data.startSubs > 0 ? data.churnUsers / data.startSubs : 0;
      const retention = 1 - churnRate;
      const cac = data.newSubs > 0 ? data.marketingSpend / data.newSubs : 0;
      const arpu = data.price * (data.grossMargin / 100);
      const ltv = retention > 0 && retention < 1 ? arpu * (retention / (1 - retention)) : 0;
      const payback = arpu > 0 ? cac / arpu : 0;
      const ratio = ltv > 0 ? cac / ltv : 0;
      const romi = calculateROMI(ltv, cac);
      const breakEven = calculateBreakEven(cac, arpu);
      const efficiency = Math.min(100, Math.max(0, (ltv / cac - 1) * 50));
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
      let status, statusColor, recommendations;
      if (efficiency >= 80) {
        status = "–û—Ç–ª–∏—á–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å";
        statusColor = "#27ae60";
        recommendations = `
          <ul>
            <li>üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ –±–∏–∑–Ω–µ—Å: —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –±—é–¥–∂–µ—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥</li>
            <li>üåç –†–∞—Å—à–∏—Ä—è–π—Ç–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏—é –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è</li>
            <li>üì¶ –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–ª–∏ —É—Å–ª—É–≥–∏</li>
            <li>‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–≤–∏—Å–∞</li>
          </ul>
        `;
      } else if (efficiency >= 60) {
        status = "–•–æ—Ä–æ—à–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å";
        statusColor = "#f39c12";
        recommendations = `
          <ul>
            <li>üìà –†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤</li>
            <li>üéØ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã</li>
            <li>üîß –£–ª—É—á—à–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏</li>
            <li>üí° –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏</li>
          </ul>
        `;
      } else {
        status = "–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ";
        statusColor = "#e74c3c";
        recommendations = `
          <ul>
            <li>‚¨áÔ∏è –°—Ä–æ—á–Ω–æ —Å–Ω–∏–∂–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (CAC)</li>
            <li>‚¨ÜÔ∏è –ü–æ–≤—ã—à–∞–π—Ç–µ –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (LTV)</li>
            <li>üîÑ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å</li>
            <li>üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã</li>
          </ul>
        `;
      }
      
      // –°–æ–∑–¥–∞–µ–º HTML –æ—Ç—á–µ—Ç–∞
      const reportHTML = `
        <!DOCTYPE html>
        <html lang="ru">
        <head>
          <meta charset="UTF-8"/>
          <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
          <title>–û—Ç—á–µ—Ç –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –ø–æ–¥–ø–∏—Å–∫–∏</title>
          <style>
            body {
              font-family: 'Arial', sans-serif;
              line-height: 1.6;
              color: #333;
              margin: 0;
              padding: 20px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            
            .report-container {
              max-width: 800px;
              margin: 0 auto;
              padding: 30px;
              background: white;
              border-radius: 20px;
              box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            }
            
            .report-header {
              text-align: center;
              margin-bottom: 40px;
              padding-bottom: 20px;
              border-bottom: 2px solid #f1f5f9;
            }
            
            .report-title {
              color: #1e293b;
              font-size: 32px;
              margin-bottom: 10px;
              font-weight: 800;
            }
            
            .report-date {
              color: #64748b;
              font-size: 16px;
            }
            
            .report-section {
              margin-bottom: 40px;
            }
            
            .report-section-title {
              color: #6366f1;
              font-size: 24px;
              margin-bottom: 20px;
              padding-bottom: 10px;
              border-bottom: 2px solid #e2e8f0;
              font-weight: 700;
            }
            
            .report-table {
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 30px;
              background: white;
              border-radius: 12px;
              overflow: hidden;
              box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            }
            
            .report-table th, .report-table td {
              padding: 15px;
              text-align: left;
              border-bottom: 1px solid #f1f5f9;
            }
            
            .report-table th {
              background: #f8fafc;
              font-weight: 700;
              color: #475569;
            }
            
            .report-metric {
              background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
              border-radius: 16px;
              padding: 20px;
              margin-bottom: 20px;
              box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            }
            
            .report-metric-title {
              font-weight: 700;
              color: #475569;
              margin-bottom: 10px;
              font-size: 18px;
            }
            
            .report-metric-value {
              font-size: 28px;
              font-weight: 800;
              color: #6366f1;
            }
            
            .report-efficiency {
              text-align: center;
              margin: 40px 0;
            }
            
            .report-efficiency-bar {
              height: 30px;
              background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
              border-radius: 15px;
              position: relative;
              margin: 25px 0;
            }
            
            .report-efficiency-marker {
              position: absolute;
              top: -15px;
              width: 60px;
              height: 60px;
              background-color: white;
              border: 5px solid #6366f1;
              border-radius: 50%;
              transform: translateX(-50%);
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: 800;
              font-size: 18px;
            }
            
            .report-recommendations {
              background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
              border-radius: 16px;
              padding: 25px;
              margin: 30px 0;
            }
            
            .report-recommendations h3 {
              margin-top: 0;
              color: #4338ca;
              font-size: 22px;
              margin-bottom: 15px;
            }
            
            .report-recommendations ul {
              margin-bottom: 0;
              padding-left: 20px;
            }
            
            .report-recommendations li {
              margin-bottom: 10px;
              font-size: 16px;
            }
            
            .report-footer {
              text-align: center;
              margin-top: 50px;
              padding-top: 20px;
              border-top: 1px solid #e2e8f0;
              color: #64748b;
              font-size: 14px;
            }
            
            @media print {
              body {
                background: white;
                padding: 0;
              }
              
              .report-container {
                box-shadow: none;
                max-width: 100%;
                margin: 0;
                padding: 20px;
              }
            }
          </style>
        </head>
        <body>
          <div class="report-container">
            <div class="report-header">
              <h1 class="report-title">üìä –û—Ç—á–µ—Ç –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –ø–æ–¥–ø–∏—Å–∫–∏</h1>
              <div class="report-date">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU')}</div>
            </div>
            
            <div class="report-section">
              <h2 class="report-section-title">üìù –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
              <table class="report-table">
                <tr>
                  <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                  <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                </tr>
                <tr>
                  <td>–ù–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</td>
                  <td>${fmt(data.startSubs)}</td>
                </tr>
                <tr>
                  <td>–û—Ç—Ç–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥</td>
                  <td>${fmt(data.churnUsers)}</td>
                </tr>
                <tr>
                  <td>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</td>
                  <td>${fmt(data.marketingSpend)} ‚ÇΩ</td>
                </tr>
                <tr>
                  <td>–ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥</td>
                  <td>${fmt(data.newSubs)}</td>
                </tr>
                <tr>
                  <td>–ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –≤ –º–µ—Å—è—Ü</td>
                  <td>${fmt(data.newSubsMonthly)}</td>
                </tr>
                <tr>
                  <td>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏</td>
                  <td>${fmt(data.price)} ‚ÇΩ</td>
                </tr>
                <tr>
                  <td>–í–∞–ª–æ–≤–∞—è –º–∞—Ä–∂–∞</td>
                  <td>${fmt(data.grossMargin)}%</td>
                </tr>
              </table>
            </div>
            
            <div class="report-section">
              <h2 class="report-section-title">üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤</h2>
              
              <div class="report-metric">
                <div class="report-metric-title">–û—Ç—Ç–æ–∫ (Churn Rate)</div>
                <div class="report-metric-value">${fmt(churnRate * 100)}%</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–£–¥–µ—Ä–∂–∞–Ω–∏–µ (Retention Rate)</div>
                <div class="report-metric-value">${fmt(retention * 100)}%</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è (CAC)</div>
                <div class="report-metric-value">${fmt(cac)} ‚ÇΩ</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (LTV)</div>
                <div class="report-metric-value">${fmt(ltv)} ‚ÇΩ</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å</div>
                <div class="report-metric-value">${fmt(payback, 1)} –º–µ—Å.</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ CAC/LTV</div>
                <div class="report-metric-value">${fmt(ratio * 100)}%</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">ROMI</div>
                <div class="report-metric-value">${romi}%</div>
              </div>
              
              <div class="report-metric">
                <div class="report-metric-title">–¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</div>
                <div class="report-metric-value">${breakEven} –º–µ—Å.</div>
              </div>
            </div>
            
            <div class="report-section">
              <h2 class="report-section-title">üéØ –°–≤–æ–¥–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
              
              <div class="report-efficiency">
                <div style="font-size: 20px; margin-bottom: 15px; color: #475569; font-weight: 600;">–£—Ä–æ–≤–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞</div>
                <div class="report-efficiency-bar">
                  <div class="report-efficiency-marker" style="left: ${efficiency}%; color: ${statusColor};">
                    ${efficiency.toFixed(0)}%
                  </div>
                </div>
                <div style="font-size: 28px; font-weight: 800; color: ${statusColor}; margin-top: 20px;">
                  ${status}
                </div>
              </div>
              
              <div class="report-recommendations">
                <h3>üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h3>
                ${recommendations}
              </div>
            </div>
            
            <div class="report-footer">
              <p>–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –ø–æ–¥–ø–∏—Å–∫–∏</p>
              <p>–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ PDF –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—á–∞—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+P)</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Ç—á–µ—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
      const reportWindow = window.open('', '_blank');
      reportWindow.document.write(reportHTML);
      reportWindow.document.close();
      
      showToast('–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω!');
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    resetForm();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    Object.values(elements).forEach(element => {
      if (element.tagName === 'INPUT') {
        element.addEventListener('input', calculate);
      }
    });
  </script>
</body>
</html>
